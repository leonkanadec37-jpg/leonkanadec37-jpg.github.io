<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />

  <!-- SEO -->
  <title data-i18n="meta.title">Каталог жемчужной бижутерии — купить серьги, браслеты, кулоны, кольца | Livi Jewelry</title>
  <meta name="description" content="Украшения из жемчуга и натуральных камней: серьги, браслеты, кулоны, кольца. Бижутерия ручной работы — в наличии и на заказ. Каталог Livi Jewelry, доставка по Казахстану.">
  <link rel="canonical" href="https://livijewelry.kz/shop.html">

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Каталог жемчужной бижутерии — Livi Jewelry">
  <meta property="og:description" content="Серьги, браслеты, кулоны, кольца — бижутерия из натурального жемчуга. В наличии и на заказ.">
  <meta property="og:url" content="https://livijewelry.kz/shop.html">
  <meta property="og:image" content="https://livijewelry.kz/images/og-cover.jpg">
  <meta name="twitter:card" content="summary_large_image">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Icons & Manifest -->
  <link rel="icon" type="image/png" sizes="48x48" href="/favicon-48.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16.png">
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#111111">
  <meta name="msapplication-TileColor" content="#111111">

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-4H6HK8K9SJ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-4H6HK8K9SJ');
    gtag('config', 'AW-16793974126');
  </script>

  <style>
    :root{--fg:#111;--muted:#666;--line:#eee;--radius:18px;--shadow:0 8px 28px rgba(0,0,0,.08);--max:1240px}
    *{box-sizing:border-box;margin:0;padding:0}
    body{font:16px/1.6 "Montserrat",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#fff;color:var(--fg)}
    a{text-decoration:none;color:inherit}

    header{position:sticky;top:0;z-index:60;background:rgba(255,255,255,.95);backdrop-filter:saturate(160%) blur(8px);border-bottom:1px solid var(--line)}
    .nav{max-width:var(--max);margin:0 auto;padding:12px 16px;display:grid;grid-template-columns:auto 1fr auto;align-items:center;gap:12px}
    .hamburger{width:42px;height:42px;border-radius:12px;border:1px solid var(--line);background:#fff;display:inline-grid;place-items:center;cursor:pointer}
    .hamburger span{width:18px;height:2px;background:#111;display:block;position:relative}
    .hamburger span::before,.hamburger span::after{content:"";position:absolute;left:0;width:18px;height:2px;background:#111}
    .hamburger span::before{top:-6px}.hamburger span::after{top:6px}
    .brand{justify-self:center;display:flex;align-items:center;gap:8px;font-weight:800;letter-spacing:.06em}
    .brand img{height:24px}
    .cart-link{justify-self:end;position:relative;border:1px solid var(--line);border-radius:999px;padding:8px 12px}
    .cart-badge{position:absolute;top:-6px;right:-6px;background:#111;color:#fff;border-radius:999px;font-size:12px;line-height:1;padding:4px 6px;min-width:20px;text-align:center;display:none}

    .drawer{position:fixed;inset:0;z-index:100;display:none}
    .drawer.open{display:block}
    .drawer-back{position:absolute;inset:0;background:rgba(0,0,0,.5)}
    .drawer-panel{position:absolute;left:10px;top:10px;bottom:10px;width:min(86vw,320px);background:#fff;border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow);padding:14px;display:flex;flex-direction:column;gap:10px}
    .drawer a,.drawer button{display:block;padding:10px 12px;border:1px solid var(--line);border-radius:12px;background:#fff;text-align:left;cursor:pointer}
    .lang{display:flex;gap:8px}.lang button{flex:1}

    .wrap{max-width:var(--max);margin:0 auto;padding:24px 16px}
    h1{font-size:clamp(24px,5vw,42px);margin-bottom:18px;text-align:center}

    .filters{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-bottom:16px}
    .tag{border:1px solid var(--line);border-radius:999px;padding:9px 16px;font-size:14px;font-weight:600;color:#111;letter-spacing:.02em;background:#fff;cursor:pointer;transition:.2s}
    .tag.active,.tag:hover{background:#111;color:#fff;border-color:#111}

    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px}
    .card{border:1px solid var(--line);border-radius:var(--radius);overflow:hidden;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,.04);transition:.25s;cursor:pointer}
    .card:hover{transform:translateY(-3px);box-shadow:var(--shadow)}
    .card img{width:100%;aspect-ratio:4/5;object-fit:cover;display:block}
    .body{padding:12px}
    .title{font-weight:600;margin-bottom:6px}
    .price{font-weight:700}
    .btn{display:inline-block;background:#111;color:#fff;padding:8px 14px;border-radius:999px;font-size:14px;border:0;cursor:pointer;margin-top:10px}
    .btn:active{transform:translateY(1px)}

    .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;padding:10px;z-index:100}
    .modal.open{display:flex}
    .modal-card{width:min(900px,96vw);max-height:92vh;overflow:auto;background:#fff;border-radius:20px;display:grid;grid-template-columns:1fr 1fr}
    .modal-left{background:#000}
    .modal-left img{width:100%;height:100%;object-fit:contain}
    .modal-right{padding:18px}
    .modal-title{font-size:22px;font-weight:700;margin-bottom:8px}
    .modal-price{font-weight:700;margin-bottom:8px}
    .modal-desc{color:var(--muted);font-size:15px;margin-bottom:16px}
    .qty{display:flex;align-items:center;gap:10px;margin-bottom:16px}
    .qty button{width:36px;height:36px;border-radius:10px;border:1px solid var(--line);background:#fff;cursor:pointer;font-size:20px}
    .modal-actions{display:flex;gap:10px;flex-wrap:wrap}
    .close{position:absolute;top:12px;right:12px;background:#fff;border:1px solid var(--line);border-radius:999px;padding:6px 10px;cursor:pointer}

    @media(max-width:520px){
      .grid{grid-template-columns:repeat(2,1fr);gap:12px}
      .card img{height:170px;aspect-ratio:auto}
      .body{padding:10px}
    }
    @media(max-width:760px){ .modal-card{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <!-- Drawer -->
  <div id="drawer" class="drawer" aria-hidden="true">
    <div class="drawer-back"></div>
    <div class="drawer-panel" role="menu" aria-label="Меню">
      <a href="index.html" data-i18n="nav.home">Главная</a>
      <a href="shop.html" data-i18n="nav.shop">Каталог</a>
      <a href="https://instagram.com/livi_jwl" target="_blank" rel="noopener">Instagram</a>
      <a href="https://wa.me/77054510584?text=Здравствуйте!%20Хочу%20украшение%20Livi%20Jewelry." target="_blank" rel="noopener">WhatsApp</a>
      <div class="lang"><button id="ruBtn">RU</button><button id="kkBtn">KZ</button><button id="enBtn">EN</button></div>
    </div>
  </div>

  <header>
    <div class="nav">
      <button id="burger" class="hamburger" aria-label="Меню"><span></span></button>
      <a class="brand" href="index.html">
        <img src="favicon.svg" alt="Livi Jewelry logo">
        <span>LIVI JEWELRY</span>
      </a>
      <a class="cart-link" href="cart.html" data-i18n="nav.cart">Корзина <span id="cartBadge" class="cart-badge">0</span></a>
    </div>
  </header>

  <main class="wrap">
    <h1 data-i18n="page.title">Украшения из жемчуга — каталог: серьги, браслеты, кулоны, кольца</h1>
    <div class="filters" id="filters"></div>
    <div class="grid" id="grid"></div>
  </main>

  <!-- Modal -->
  <div id="modal" class="modal" role="dialog" aria-modal="true">
    <div class="modal-card">
      <div class="modal-left"><img id="mImg" alt=""></div>
      <div class="modal-right">
        <div class="modal-title" id="mTitle"></div>
        <div class="muted" id="mCat"></div>
        <div class="modal-price" id="mPrice"></div>
        <div class="modal-desc" id="mDesc"></div>
        <div class="qty">
          <button id="mMinus" aria-label="−">−</button>
          <span id="mQty">1</span>
          <button id="mPlus" aria-label="+">+</button>
        </div>
        <div class="modal-actions">
          <button id="mAdd" class="btn" data-i18n="ui.add">В корзину</button>
          <a class="btn" href="cart.html" data-i18n="ui.openCart">Открыть корзину</a>
        </div>
      </div>
    </div>
    <button class="close" id="mClose" aria-label="Закрыть">✕</button>
  </div>

  <script>
    /* ===== i18n ===== */
    const I18N = {
      ru:{
        'meta.title':'Каталог жемчужной бижутерии — купить серьги, браслеты, кулоны, кольца | Livi Jewelry',
        'nav.home':'Главная','nav.shop':'Каталог','nav.cart':'Корзина',
        'page.title':'Украшения из жемчуга — каталог: серьги, браслеты, кулоны, кольца',
        'cat.All':'Все','cat.Necklaces':'Колье','cat.Sets':'Комплекты','cat.Bracelets':'Браслеты','cat.Lariats':'Сотуары','cat.Chains':'Цепи',
        'ui.add':'В корзину','ui.openCart':'Открыть корзину'
      },
      kk:{
        'meta.title':'Інжу әшекейлері — сырға, білезік, кулон, сақина каталоги | Livi Jewelry',
        'nav.home':'Басты бет','nav.shop':'Дүкен','nav.cart':'Себет',
        'page.title':'Інжу әшекейлері — каталог: сырғалар, білезіктер, кулондар, сақиналар',
        'cat.All':'Барлығы','cat.Necklaces':'Алқалар','cat.Sets':'Комплекттер','cat.Bracelets':'Білезіктер','cat.Lariats':'Сотуарлар','cat.Chains':'Тізбектер',
        'ui.add':'Себетке қосу','ui.openCart':'Себетті ашу'
      },
      en:{
        'meta.title':'Pearl jewellery catalog — buy earrings, bracelets, pendants, rings | Livi Jewelry',
        'nav.home':'Home','nav.shop':'Shop','nav.cart':'Cart',
        'page.title':'Pearl jewellery — catalog: earrings, bracelets, pendants, rings',
        'cat.All':'All','cat.Necklaces':'Necklaces','cat.Sets':'Sets','cat.Bracelets':'Bracelets','cat.Lariats':'Lariats','cat.Chains':'Chains',
        'ui.add':'Add to cart','ui.openCart':'Open cart'
      }
    };
    function lang(){ return localStorage.getItem('lang') || 'ru'; }
    function setLang(l){ localStorage.setItem('lang', l); applyLang(); renderFilters(); renderGrid(); }
    function tr(key){ return (I18N[lang()] && I18N[lang()][key]) || (I18N['ru']&&I18N['ru'][key]) || key; }
    function applyLang(){
      document.title = tr('meta.title'); document.documentElement.lang = lang();
      document.querySelectorAll('[data-i18n]').forEach(el=>{ el.textContent = tr(el.getAttribute('data-i18n')); });
      [ruBtn,kkBtn,enBtn].forEach(b=>b.classList.remove('active')); (lang()==='kk'?kkBtn:lang()==='en'?enBtn:ruBtn).classList.add('active');
    }

    /* ===== источник файлов (ТВОИ РАБОЧИЕ имена) ===== */
    const FILES = [
      'Choker_iz_Akvamarina_i_zhemchuga_15000_tg.webp',
      'Choker_iz_gornogo_khrustalya_i_zhemchuga_18000_tg.webp',
      'Choker_Lunnyy_kamen_s_zhemchugom_18000_tg.webp',
      'Chokery_s_zhemchugom_i_tsirkonami_20000_tg.webp',
      'Kolye_Gematitovaya_pyl_23000_tg.webp',
      'Kolye_iz_akva_kvartsa_zhemchuga_i_gornogo_khrustalya_i_gematita_30000_tg.webp',
      'Kolye_iz_raznykh_form_i_tsvetov_zhemchuga_50000_tg.webp',
      'Komplekt_Choker_Barokko_23000_tg_plus_Sergi_8500_tg.webp',
      'Komplekt_choker_iz_gematita_i_zhemchuga_15000_tg_plus_sergi_10000.webp',
      'Komplekt_dvoynoy_choker_transformer_25000_tg_plus_sergi_etno_12000_tg.webp',
      'Komplekt_Etno_stil_18000_tg_Sergi_12000_tg.webp',
      'Komplekt_Kolye_Barokko_30000_tg_plus_sergi_10000_tg.webp',
      'Komplekt_Kolye_iz_rozovogo_zhemchuga_36000_tg_plus_sergi_12000_tg.webp',
      'Komplekt_Kolye_iz_Rozovogo_zhemchuga_Mayorka_30000_plus_tg_Sergi_10000_tg.webp',
      'Komplekt_Kolye_transformer_23000_plus_sergi_10000.jpg',
      'Komplekt_kolye_zhemchug_plus_sergi_etno_30000.webp.webp',
      'Komplekt_Sotuar_galstuk_iz_zhemchuga_i_gornogo_khrustalya_18000_tg.webp.jpg'
    ];

    const CATS = ['All','Necklaces','Sets','Bracelets','Lariats','Chains'];
    const KEY='livi_cart_v2';
    const grid=document.getElementById('grid');
    const filters=document.getElementById('filters');
    let activeCat = localStorage.getItem('livi_active_cat') || 'All';

    /* ===== генерация карточек из имени файла ===== */
    function catFromName(name){
      const n=name.toLowerCase();
      if(n.startsWith('komplekt')) return 'Sets';
      if(n.startsWith('kolye') || n.startsWith('kole') || n.startsWith('choker') || n.startsWith('chokery')) return 'Necklaces';
      if(n.startsWith('sotuar') || n.includes('galstuk')) return 'Lariats';
      if(n.startsWith('chain') || n.includes('cep')) return 'Chains';
      return 'Necklaces';
    }
    function russianTitleFromName(name){
      const n = name.toLowerCase();
      const type =
        n.startsWith('komplekt') ? 'Комплект' :
        n.startsWith('kolye') || n.startsWith('kole') ? 'Колье' :
        n.startsWith('chokery') ? 'Чокеры' :
        n.startsWith('choker') ? 'Чокер' : 'Украшение';
      const has = s => n.includes(s);
      if(type==='Комплект'){
        if(has('choker_barokko')) return 'Комплект: чокер «Барокко»';
        if(has('kolye_barokko'))  return 'Комплект: колье «Барокко»';
        if(has('dvoynoy_choker_transformer')) return 'Комплект: двойной чокер-трансформер';
        if(has('choker_iz_gematita_i_zhemchuga')) return 'Комплект: чокер из гематита и жемчуга';
        if(has('kolye_transformer')) return 'Комплект: колье-трансформер';
        if(has('rozovogo_zhemchuga_mayorka')) return 'Комплект: колье «Майорка» (розовый)';
        if(has('kolye_iz_rozovogo_zhemchuga')) return 'Комплект: колье из розового жемчуга';
        if(has('sotuar_galstuk')) return 'Комплект: сотуар-галстук (жемчуг и хрусталь)';
        if(has('etno')) return 'Комплект: этно-стиль';
        if(has('kolye_zhemchug') && has('sergi_etno')) return 'Комплект: колье из жемчуга + серьги этно';
        return 'Комплект: колье и серьги';
      }
      if(has('gematitovaya_pyl')) return `${type} «Гематитовая пыль»`;
      if(has('akvamarin') && has('zhemchug')) return `${type} из аквамарина и жемчуга`;
      if((has('gornogo_khrustalya') || has('khrustal')) && has('zhemchug')) return `${type} из горного хрусталя и жемчуга`;
      if(has('lunnyy_kamen') && has('zhemchug')) return `${type} «Лунный камень» с жемчугом`;
      if(has('tsirkon')) return `${type} с жемчугом и цирконами`;
      if(has('akva_kvartsa') && has('zhemchuga') && has('gornogo_khrustalya') && has('gematita')) return `${type} из аква-кварца, жемчуга, хрусталя и гематита`;
      if(has('raznykh_form_i_tsvetov_zhemchuga')) return `${type} из жемчуга разных форм и цветов`;
      if(has('kolye') && has('barokko')) return `${type} «Барокко»`;
      return `${type} из жемчуга`;
    }
    function extractPrices(name){
      const nums = [...name.matchAll(/(\d[\d\s.,]*)\s*тг/ig)].map(m=>parseInt(m[1].replace(/[^\d]/g,''),10)).filter(Boolean);
      if(nums.length===0){
        const m = name.match(/(\d[\d\s.,]*)\D*$/);
        return {base: m ? parseInt(m[1].replace(/[^\d]/g,''),10) : 0, extra: 0};
      }
      return {base: nums[0]||0, extra: nums[1]||0};
    }
    function altByCat(cat, title){
      switch(cat){
        case 'Necklaces': return `${title} — украшения, бижутерия, колье, чокеры`;
        case 'Sets':      return `${title} — украшения, бижутерия, комплекты, серьги`;
        case 'Bracelets': return `${title} — украшения, бижутерия, браслеты`;
        case 'Lariats':   return `${title} — украшения, бижутерия, сотуары, подвески`;
        case 'Chains':    return `${title} — украшения, бижутерия, цепи, кулоны`;
        default:          return `${title} — украшения, бижутерия`;
      }
    }
    function makeProductObjects(files){
      const list=[];
      files.forEach(raw=>{
        const name = String(raw||'').trim();
        if(!name) return;
        if(!/\.(webp|jpe?g)$/i.test(name)) return;

        const cat = catFromName(name);
        const {base, extra} = extractPrices(name);
        const titleRu = russianTitleFromName(name);
        const img = `assets/${name}`;
        const ru = titleRu, kk = titleRu, en = titleRu;

        list.push({
          id: `auto_${name}_base`,
          img, cat,
          title:{ru,kk,en},
          price: base ? `${base.toLocaleString('ru-RU')} тг` : 'Цена по запросу',
          desc:{ru:'Украшения ручной работы из жемчуга и камней.', kk:'Інжу мен тастардан қолдан жасалған әшекейлер.', en:'Handcrafted jewellery with pearls and stones.'},
          alt: altByCat(cat, ru)
        });
        if(extra > 0){
          const sum = (base||0) + extra;
          const titlePlus = `${ru} + серьги`;
          list.push({
            id: `auto_${name}_plus`,
            img, cat: 'Sets',
            title:{ru:titlePlus,kk:titlePlus,en:titlePlus},
            price: `${sum.toLocaleString('ru-RU')} тг`,
            desc:{ru:'Комплект: база и серьги. Состав и длина уточняются при заказе.', kk:'Жиын: база және сырға.', en:'Set: base + earrings.'},
            alt: altByCat('Sets', titlePlus)
          });
        }
      });
      return list;
    }
    function dedupe(items){
      const map = new Map();
      items.forEach(p=>{
        const key = `${p.img}__${p.price}__${p.title.ru}`;
        if(!map.has(key)) map.set(key, p);
      });
      return [...map.values()];
    }

    let PRODUCTS = dedupe(makeProductObjects(FILES));

    // Если есть assets/manifest.json — подхватим его (например, если ты добавишь новые webp)
    fetch('assets/manifest.json')
      .then(r=>r.ok?r.json():Promise.reject())
      .then(arr=>{
        if(Array.isArray(arr) && arr.length){
          const merged = Array.from(new Set([...FILES, ...arr]));
          PRODUCTS = dedupe(makeProductObjects(merged));
          renderFilters(); renderGrid(); injectProductsJSONLD(PRODUCTS);
        }
      })
      .catch(()=>{});

    /* ===== UI ===== */
    const CATS = ['All','Necklaces','Sets','Bracelets','Lariats','Chains'];
    const grid=document.getElementById('grid');
    const filters=document.getElementById('filters');
    let activeCat = localStorage.getItem('livi_active_cat') || 'All';

    function parseUnit(priceStr){ const m=String(priceStr||'').match(/([\d\s.,]+)\s*тг/i); if(!m) return 0; return parseInt(m[1].replace(/[^\d]/g,''),10)||0; }
    const KEY='livi_cart_v2';
    function readCart(){ try{return JSON.parse(localStorage.getItem(KEY)||'[]')}catch(e){return []} }
    function writeCart(v){ localStorage.setItem(KEY, JSON.stringify(v)); updateBadge(); }
    function updateBadge(){ const count=readCart().reduce((s,i)=>s+Number(i.qty||0),0); const b=document.getElementById('cartBadge'); if(!b) return; b.style.display = count>0 ? 'inline-block':'none'; if(count>0) b.textContent=count; }
    window.addEventListener('storage',e=>{ if(e.key===KEY) updateBadge(); });

    function renderFilters(){
      filters.innerHTML='';
      CATS.forEach(c=>{
        if(c!=='All' && !PRODUCTS.some(p=>p.cat===c)) return;
        const btn=document.createElement('button');
        btn.className='tag'+(c===activeCat?' active':'');
        btn.textContent=tr('cat.'+c);
        btn.onclick=()=>{ activeCat=c; localStorage.setItem('livi_active_cat',c); renderFilters(); renderGrid(); };
        filters.appendChild(btn);
      });
    }

    function renderGrid(){
      grid.innerHTML='';
      const items=activeCat==='All'?PRODUCTS:PRODUCTS.filter(p=>p.cat===activeCat);
      items.forEach(p=>{
        const title=p.title[lang()]||p.title['ru'];
        const priceNum = parseUnit(p.price);
        const urlAbs = location.origin + '/shop.html#' + p.id;

        const card=document.createElement('article'); 
        card.className='card';
        card.setAttribute('itemscope','');
        card.setAttribute('itemtype','https://schema.org/Product');

        card.innerHTML=`
          <meta itemprop="name" content="${title}">
          <meta itemprop="description" content="${(p.desc[lang()]||p.desc['ru']).replace(/"/g,'&quot;')}">
          <link itemprop="image" href="${new URL(p.img, location.origin)}">
          <meta itemprop="url" content="${urlAbs}">
          <img src="${p.img}" alt="${p.alt}" onerror="this.onerror=null;this.src='assets/placeholder.jpg'" itemprop="image" loading="lazy" decoding="async">
          <div class="body">
            <div class="title">${title}</div>
            <div class="price"><span itemprop="offers" itemscope itemtype="https://schema.org/Offer">
              <meta itemprop="priceCurrency" content="KZT">
              <meta itemprop="availability" content="https://schema.org/InStock">
              ${priceNum ? `<meta itemprop="price" content="${priceNum}">` : ``}
              <meta itemprop="url" content="${urlAbs}">
            </span>${p.price}</div>
            <button class="btn" data-action="add">${tr('ui.add')}</button>
          </div>`;

        card.addEventListener('click',(e)=>{ if(e.target && e.target.dataset && e.target.dataset.action==='add'){ return; } openModal(p); }, {passive:true});
        card.querySelector('[data-action="add"]').onclick=()=>addToCart(p,1);
        grid.appendChild(card);
      });
    }

    /* ===== JSON-LD (ItemList + Product) ===== */
    function injectProductsJSONLD(items){
      const data = {
        "@context":"https://schema.org",
        "@type":"ItemList",
        "itemListElement": items.map((p,i)=>{
          const title = p.title[lang()] || p.title['ru'];
          const desc  = p.desc[lang()]  || p.desc['ru'];
          const price = parseUnit(p.price);
          const url   = location.origin + '/shop.html#' + p.id;
          return {
            "@type":"ListItem",
            "position": i+1,
            "url": url,
            "item":{
              "@type":"Product",
              "name": title,
              "image": [ new URL(p.img, location.origin).href ],
              "description": desc,
              "sku": p.id,
              "offers":{
                "@type":"Offer",
                "priceCurrency":"KZT",
                ...(price ? { "price": String(price) } : {}),
                "availability":"https://schema.org/InStock",
                "url": url
              }
            }
          };
        })
      };
      const s=document.createElement('script');
      s.type='application/ld+json';
      s.textContent=JSON.stringify(data);
      document.head.appendChild(s);
    }

    /* ===== CART ===== */
    function addToCart(p, qty){
      const q=Math.max(1, Number(qty||1));
      const cart=readCart(); const i=cart.findIndex(x=>x.id===p.id);
      const unit = parseUnit(p.price);
      const title=p.title[lang()]||p.title['ru'];
      if(i>-1){ cart[i].qty+=q; if(typeof cart[i].unit!=='number') cart[i].unit=unit; cart[i].title=title; }
      else{ cart.push({id:p.id,title,price:p.price,img:p.img,qty:q,unit}); }
      writeCart(cart); updateBadge();
    }

    /* ===== MODAL ===== */
    const modal=document.getElementById('modal');
    const mImg=document.getElementById('mImg'), mTitle=document.getElementById('mTitle'), mCat=document.getElementById('mCat'),
          mPrice=document.getElementById('mPrice'), mDesc=document.getElementById('mDesc'), mQtyEl=document.getElementById('mQty');
    const mMinus=document.getElementById('mMinus'), mPlus=document.getElementById('mPlus'), mAdd=document.getElementById('mAdd'), mClose=document.getElementById('mClose');
    let currentProduct=null;

    function openModal(p){
      currentProduct=p;
      mImg.src=p.img; mImg.alt=p.alt|| (p.title[lang()]||p.title['ru']);
      mTitle.textContent=p.title[lang()]||p.title['ru'];
      mCat.textContent=tr('cat.'+p.cat);
      mPrice.textContent=p.price;
      mDesc.textContent=p.desc[lang()]||p.desc['ru'];
      mQtyEl.textContent='1'; mAdd.textContent=tr('ui.add');
      modal.classList.add('open'); document.body.style.overflow='hidden';
    }
    function closeModal(){ modal.classList.remove('open'); document.body.style.overflow=''; }
    mMinus.onclick=()=>{ const n=Math.max(1, Number(mQtyEl.textContent)-1); mQtyEl.textContent=n; };
    mPlus.onclick =()=>{ const n=Number(mQtyEl.textContent)+1; mQtyEl.textContent=n; };
    mAdd.onclick  =()=>{ if(currentProduct){ addToCart(currentProduct, Number(mQtyEl.textContent)); closeModal(); } };
    mClose.onclick=closeModal;
    modal.addEventListener('click',(e)=>{ if(e.target===modal) closeModal(); });
    document.addEventListener('keydown',(e)=>{ if(e.key==='Escape' && modal.classList.contains('open')) closeModal(); });

    // Drawer controls
    const drawer=document.getElementById('drawer'), burger=document.getElementById('burger');
    const ruBtn=document.getElementById('ruBtn'), kkBtn=document.getElementById('kkBtn'), enBtn=document.getElementById('enBtn');
    burger.onclick=()=>{ drawer.classList.add('open'); drawer.setAttribute('aria-hidden','false'); };
    drawer.querySelector('.drawer-back').onclick=()=>{ drawer.classList.remove('open'); drawer.setAttribute('aria-hidden','true'); };
    ruBtn.onclick=()=>setLang('ru'); kkBtn.onclick=()=>setLang('kk'); enBtn.onclick=()=>setLang('en');

    // Init
    applyLang(); renderFilters(); renderGrid(); updateBadge(); injectProductsJSONLD(PRODUCTS);

    /* ===== Конверсия WhatsApp ===== */
    (function(){
      function isWaLink(a){ if(!a || !a.href) return false; const href=a.href.toLowerCase(); return href.includes('wa.me') || href.includes('whatsapp'); }
      function reportConversion(url){
        try{
          const callback=function(){ if(url){ window.location=url; } };
          gtag('event','conversion',{
            'send_to':'AW-16793974126/MuJ_CObHup8bEO7q_sc-','value':0,'currency':'KZT','event_callback':callback
          });
          return false;
        }catch(e){ if(url){ window.location=url; } return false; }
      }
      document.addEventListener('click',function(e){
        const a = e.target.closest('a'); if(!a) return;
        if(isWaLink(a)){ e.preventDefault(); reportConversion(a.href); }
      });
    })();
  </script>
</body>
</html>
