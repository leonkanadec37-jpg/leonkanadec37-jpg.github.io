<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Livi Jewelry — Корзина</title>
<style>
  :root{--fg:#111;--muted:#666;--line:#eee;--radius:18px;--shadow:0 8px 28px rgba(0,0,0,.08)}
  *{box-sizing:border-box;margin:0;padding:0}
  body{font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#fff;color:var(--fg)}
  a{color:inherit;text-decoration:none}
  header{position:sticky;top:0;z-index:50;background:#fff;border-bottom:1px solid var(--line)}
  .nav{max-width:960px;margin:0 auto;padding:14px 18px;display:flex;gap:12px;align-items:center;justify-content:space-between}
  .brand{font-weight:700;letter-spacing:.08em}
  .wrap{max-width:960px;margin:0 auto;padding:26px 18px}
  h1{font-size:clamp(22px,4.8vw,34px);margin-bottom:16px}
  .empty{padding:24px;border:1px dashed var(--line);border-radius:16px;text-align:center;color:var(--muted)}
  .list{display:grid;gap:14px;margin:18px 0}
  .item{display:grid;grid-template-columns:90px 1fr auto;gap:12px;align-items:center;border:1px solid var(--line);border-radius:var(--radius);padding:10px}
  .thumb{width:90px;height:90px;border-radius:12px;overflow:hidden;background:#fafafa}
  .thumb img{width:100%;height:100%;object-fit:cover;display:block}
  .title{font-weight:600}
  .muted{color:var(--muted);font-size:14px}
  .qty{display:flex;align-items:center;gap:8px}
  .qty button{width:28px;height:28px;border-radius:8px;border:1px solid var(--line);background:#fff;cursor:pointer}
  .sum{font-weight:700}
  .totals{margin-top:16px;border-top:1px solid var(--line);padding-top:14px;display:flex;flex-wrap:wrap;gap:12px;justify-content:space-between;align-items:center}
  .btn{background:#111;color:#fff;border:0;border-radius:999px;padding:12px 16px;cursor:pointer}
  .btn.alt{background:#fff;color:#111;border:1px solid var(--line)}
  @media (max-width:560px){
    .item{grid-template-columns:72px 1fr;grid-template-areas:
      "thumb title" "thumb qty" "thumb sum";}
    .thumb{grid-area:thumb;width:72px;height:72px}
    .title{grid-area:title}
    .qty{grid-area:qty}
    .sum{grid-area:sum}
  }
</style>
</head>
<body>
<header>
  <div class="nav">
    <a class="brand" href="index.html">LIVI JEWELRY</a>
    <div>
      <a class="btn alt" href="shop.html">Каталог</a>
    </div>
  </div>
</header>

<main class="wrap">
  <h1>Корзина</h1>
  <div id="container"></div>
</main>

<script>
const KEY='livi_cart';
function read(){ try{ return JSON.parse(localStorage.getItem(KEY))||[] }catch(e){ return [] } }
function write(v){ localStorage.setItem(KEY, JSON.stringify(v)); render(); }
function money(n){ return n.toLocaleString('ru-RU')+' тг' }

function render(){
  const root=document.getElementById('container');
  const items=read();
  if(!items.length){
    root.innerHTML = `<div class="empty">Ваша корзина пуста.<br><br><a class="btn alt" href="shop.html">Перейти в каталог</a></div>`;
    return;
  }
  const list=document.createElement('div'); list.className='list';
  let total=0;
  items.forEach((it,idx)=>{
    const line=document.createElement('div'); line.className='item';
    const sum = it.price*it.qty; total+=sum;
    line.innerHTML = `
      <div class="thumb"><img src="${it.img}" alt="${it.title}"></div>
      <div class="title">${it.title}<div class="muted">${it.price.toLocaleString('ru-RU')} тг · ID: ${it.id}</div></div>
      <div class="qty">
        <button aria-label="минус">−</button>
        <div>${it.qty}</div>
        <button aria-label="плюс">+</button>
        <button class="btn alt" style="margin-left:8px">Удалить</button>
      </div>
      <div class="sum">${money(sum)}</div>
    `;
    const [minus, , plus, del] = line.querySelectorAll('.qty button');
    minus.onclick=()=>{ const arr=read(); if(arr[idx].qty>1){arr[idx].qty--} else {arr.splice(idx,1)} write(arr) };
    plus.onclick =()=>{ const arr=read(); arr[idx].qty++; write(arr) };
    del.onclick  =()=>{ const arr=read(); arr.splice(idx,1); write(arr) };
    list.appendChild(line);
  });

  const totals=document.createElement('div'); totals.className='totals';
  totals.innerHTML = `
    <div><strong>Итого:</strong> ${money(total)}</div>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn alt" onclick="clearCart()">Очистить</button>
      <a class="btn" href="shop.html">Продолжить покупки</a>
    </div>
  `;

  root.innerHTML='';
  root.appendChild(list);
  root.appendChild(totals);
}

function clearCart(){ localStorage.setItem(KEY, '[]'); render(); }

// гарантируем одинаковую корзину между устройствами/вкладками
window.addEventListener('storage', e=>{ if(e.key===KEY) render() });

// ХАК для десктопа (иногда браузеры не сразу коммитят запись):
// на этой странице мы форсируем чтение после фокуса, чтобы избежать эффекта "пусто" на ПК.
window.addEventListener('focus', render);
document.addEventListener('visibilitychange', ()=>{ if(!document.hidden) render() });

render();
</script>
</body>
</html>
