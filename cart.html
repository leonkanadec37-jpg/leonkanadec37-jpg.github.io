<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Корзина — Livi Jewelry</title>
  <meta name="description" content="Корзина Livi Jewelry. Оформите заказ в WhatsApp.">
  <link rel="canonical" href="https://livijewelry.kz/cart.html">
  <link rel="icon" href="/favicon.ico">
  <style>
    :root{--fg:#111;--muted:#666;--line:#eee;--bg:#fff;--radius:18px}
    *{box-sizing:border-box;margin:0;padding:0}
    body{font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial;color:var(--fg);background:var(--bg)}
    a{color:inherit;text-decoration:none}

    header{position:sticky;top:0;z-index:40;background:rgba(255,255,255,.9);backdrop-filter:saturate(160%) blur(8px);border-bottom:1px solid var(--line)}
    .nav{max-width:1240px;margin:0 auto;padding:14px 20px;display:flex;gap:14px;align-items:center;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:10px}
    .brand img{display:block;height:44px;object-fit:contain}
    .nav-left{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .nav-left a:not(.brand){border:1px solid var(--line);border-radius:999px;padding:8px 12px;font-size:14px}
    .cart-link{position:relative}
    .cart-badge{position:absolute;top:-6px;right:-6px;background:#111;color:#fff;border-radius:999px;font-size:12px;line-height:1;padding:4px 6px;min-width:20px;text-align:center}

    main{max-width:960px;margin:0 auto;padding:28px 20px}
    h1{font-size:clamp(26px,4.2vw,42px);margin-bottom:16px}
    .row{display:grid;grid-template-columns:1fr auto auto auto;gap:10px;align-items:center;border-bottom:1px solid var(--line);padding:10px 0}
    .row img{width:64px;height:64px;object-fit:cover;border-radius:10px}
    .muted{color:var(--muted)}
    .total{display:flex;justify-content:space-between;align-items:center;margin-top:16px}
    .btn{display:inline-block;background:#111;color:#fff;padding:12px 18px;border-radius:999px}
    .empty{padding:30px 0;color:var(--muted)}
  </style>
</head>
<body>
<header>
  <div class="nav">
    <div class="nav-left">
      <a class="brand" href="index.html"><img src="1200.JPG" alt="Livi Jewelry" onerror="this.style.display='none'"></a>
      <a href="shop.html">Каталог</a>
      <a href="index.html#about">О нас</a>
      <a class="cart-link" href="cart.html">Корзина <span id="cartBadge" class="cart-badge" style="display:none;">0</span></a>
    </div>
  </div>
</header>

<main>
  <h1>Корзина</h1>
  <div id="cart"></div>
  <div class="total">
    <strong>Итого: <span id="sum">0 ₸</span></strong>
    <a id="checkout" class="btn" href="#" target="_blank" rel="noopener">Оформить в WhatsApp</a>
  </div>
</main>

<script>
  const WA = '77054510584'; // номер WhatsApp без +
  function readCart(){ try{return JSON.parse(localStorage.getItem('livi_cart_v2')||'[]')}catch(e){return []} }
  function writeCart(c){ localStorage.setItem('livi_cart_v2', JSON.stringify(c)); update(); }
  function updateBadge(){
    const count = readCart().reduce((s,i)=>s+i.qty,0);
    const b = document.getElementById('cartBadge');
    if(!b) return;
    b.style.display = count>0 ? 'inline-block':'none';
    if(count>0) b.textContent = count;
  }
  function fmt(n){ return n.toLocaleString('ru-KZ') + ' ₸'; }

  function update(){
    const list = readCart();
    updateBadge();
    const wrap = document.getElementById('cart');
    if(list.length===0){
      wrap.innerHTML = `<p class="empty">Корзина пуста</p>`;
      document.getElementById('sum').textContent = fmt(0);
      document.getElementById('checkout').href = '#';
      return;
    }
    let html = '';
    let sum = 0;
    for(const it of list){
      sum += it.price * it.qty;
      html += `
        <div class="row">
          <img src="${it.image||''}" alt="${it.name||''}" onerror="this.style.display='none'">
          <div><div>${it.name}</div><div class="muted">${fmt(it.price)} × ${it.qty}</div></div>
          <div><button onclick="chgQty('${it.id}',-1)">−</button> <button onclick="chgQty('${it.id}',1)">+</button></div>
          <div><button onclick="rm('${it.id}')">Удалить</button></div>
        </div>`;
    }
    wrap.innerHTML = html;
    document.getElementById('sum').textContent = fmt(sum);

    // подготовка сообщения для WhatsApp
    const lines = list.map(i => `${i.name} — ${i.qty} шт × ${fmt(i.price)}`).join('%0A');
    const msg = `Здравствуйте! Хочу оформить заказ:%0A${lines}%0AИтого: ${fmt(sum)}`;
    document.getElementById('checkout').href = `https://wa.me/${WA}?text=${msg}`;
  }

  function chgQty(id,delta){
    const c = readCart();
    const i = c.findIndex(x=>x.id===id);
    if(i<0) return;
    c[i].qty += delta;
    if(c[i].qty<=0) c.splice(i,1);
    writeCart(c);
  }
  function rm(id){
    const c = readCart().filter(x=>x.id!==id);
    writeCart(c);
  }
  update();
  window.addEventListener('storage',e=>{ if(e.key==='livi_cart_v2') update(); });
</script>
</body>
</html>
