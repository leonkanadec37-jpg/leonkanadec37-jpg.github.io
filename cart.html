<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Livi Jewelry — Корзина</title>
<link rel="icon" href="favicon.ico">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MD9RD4B3');</script>
<!-- End Google Tag Manager -->

<style>
  :root{--fg:#111;--muted:#666;--line:#eee;--radius:16px;--shadow:0 8px 28px rgba(0,0,0,.08)}
  *{box-sizing:border-box;margin:0;padding:0}
  body{font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#fff;color:var(--fg)}
  a{text-decoration:none;color:inherit;-webkit-tap-highlight-color:transparent}

  header{position:sticky;top:0;z-index:40;background:rgba(255,255,255,.92);backdrop-filter:saturate(160%) blur(8px);border-bottom:1px solid var(--line)}
  .nav{max-width:1240px;margin:0 auto;padding:12px 16px;display:flex;gap:10px;align-items:center;justify-content:space-between}
  .brand{font-weight:800;letter-spacing:.08em}
  .nav-left{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .nav-left a{border:1px solid var(--line);border-radius:999px;padding:8px 12px;font-size:14px}
  .wrap{max-width:1000px;margin:0 auto;padding:22px 16px}
  h1{font-size:clamp(22px,4.4vw,38px);margin-bottom:12px}

  .empty{padding:24px;border:1px dashed var(--line);border-radius:16px;text-align:center;color:var(--muted)}
  .list{display:grid;gap:12px;margin:16px 0}
  .item{display:grid;grid-template-columns:96px 1fr auto auto;gap:12px;align-items:center;border:1px solid var(--line);border-radius:var(--radius);padding:10px}
  .thumb{width:96px;height:96px;border-radius:12px;overflow:hidden;background:#f5f5f5}
  .thumb img{width:100%;height:100%;object-fit:cover;display:block}
  .title{font-weight:600}
  .muted{color:var(--muted);font-size:14px}
  .qty{display:flex;gap:8px;align-items:center}
  .btn{border:1px solid var(--line);background:#fff;border-radius:10px;padding:6px 10px;cursor:pointer}
  .btn--primary{background:#111;color:#fff;border-color:#111}
  .total{display:flex;justify-content:space-between;align-items:center;margin-top:16px;border-top:1px solid var(--line);padding-top:12px}
  .actions{display:flex;gap:10px;flex-wrap:wrap}

  @media (max-width:560px){
    .item{grid-template-columns:72px 1fr;grid-template-areas:
      "thumb title" "thumb qty" "thumb del"; align-items:start}
    .thumb{width:72px;height:72px}
  }
  .cart-link{position:relative}
  .cart-badge{position:absolute;top:-6px;right:-6px;background:#111;color:#fff;border-radius:999px;font-size:12px;line-height:1;padding:4px 6px;min-width:20px;text-align:center}
  .lang{display:flex;border:1px solid var(--line);border-radius:999px;overflow:hidden}
  .lang button{border:0;background:transparent;padding:8px 12px;font-size:13px;cursor:pointer}
  .lang button.active{background:#111;color:#fff}

  /* ===== Mobile polish (<=480px) ===== */
  @media (max-width:480px){
    header{ background:rgba(255,255,255,.96); backdrop-filter:saturate(160%) blur(8px); }
    .nav{ padding:10px 12px; gap:8px; }
    .nav-left{
      overflow-x:auto; white-space:nowrap; gap:6px;
      padding-bottom:4px; margin-bottom:-4px;
      -webkit-overflow-scrolling:touch;
    }
    .nav-left::-webkit-scrollbar{ display:none; }
    .nav-left a{ display:inline-block; padding:8px 10px; font-size:13px; }
    .lang button{ padding:8px 10px; font-size:12.5px; }
    .cart-badge{ top:-4px; right:-4px; padding:3px 6px; font-size:11px; }
    body{ padding-left:env(safe-area-inset-left); padding-right:env(safe-area-inset-right); }
    header{ padding-top:env(safe-area-inset-top); }
    .actions .btn{ width:100%; }
    .actions{ justify-content:flex-end; }
  }
</style>
</head>
<body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MD9RD4B3"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<header>
  <div class="nav">
    <div class="nav-left">
      <a class="brand" href="index.html">LIVI JEWELRY</a>
      <a href="shop.html" id="navCatalog" data-ru="Каталог" data-kk="Каталог" data-en="Shop">Каталог</a>
      <a class="cart-link" href="cart.html" aria-label="Корзина">
        <span id="navCart" data-ru="Корзина" data-kk="Себет" data-en="Cart">Корзина</span>
        <span id="cartBadge" class="cart-badge" style="display:none;">0</span>
      </a>
    </div>
    <div class="nav-right">
      <div class="lang">
        <button id="ruBtn" class="active">RU</button>
        <button id="kkBtn">KZ</button>
        <button id="enBtn">EN</button>
      </div>
    </div>
  </div>
</header>

<main class="wrap">
  <h1 id="pageTitle" data-ru="Корзина" data-kk="Себет" data-en="Cart">Корзина</h1>
  <div id="root"></div>
</main>

<script>
  const KEY='livi_cart_v2';

  const UI = {
    ru:{ empty:'Ваша корзина пуста.', goShop:'Перейти в каталог', yourOrder:'Ваш заказ:', clear:'Очистить', checkout:'Оформить в WhatsApp', remove:'Удалить' },
    kk:{ empty:'Себет бос.', goShop:'Каталогқа өту', yourOrder:'Сіздің тапсырысыңыз:', clear:'Тазарту', checkout:'WhatsApp арқылы рәсімдеу', remove:'Жою' },
    en:{ empty:'Your cart is empty.', goShop:'Go to catalog', yourOrder:'Your order:', clear:'Clear', checkout:'Checkout via WhatsApp', remove:'Remove' }
  };

  function lang(){ return localStorage.getItem('lang') || 'ru'; }
  function setLangButtons(){
    const l=lang();
    document.querySelectorAll('[data-ru]').forEach(el=>{
      const txt = l==='kk'?el.getAttribute('data-kk'): l==='en'?el.getAttribute('data-en'): el.getAttribute('data-ru');
      if(txt) el.textContent=txt;
    });
    [ruBtn,kkBtn,enBtn].forEach(b=>b.classList.remove('active'));
    (l==='kk'?kkBtn:l==='en'?enBtn:ruBtn).classList.add('active');
    document.documentElement.lang=l;
  }

  function read(){ try{return JSON.parse(localStorage.getItem(KEY)||'[]')}catch(e){return []} }
  function write(v){ localStorage.setItem(KEY, JSON.stringify(v)); render(); }

  function render(){
    const root=document.getElementById('root');
    const cart=read();
    const L=UI[lang()];

    if(cart.length===0){
      root.innerHTML = `<div class="empty">${L.empty}<br><br><a href="shop.html">${L.goShop}</a></div>`;
      updateBadge();
      return;
    }

    let totalText = cart.map(i=>`${i.title} × ${i.qty} (${i.price})`).join(' • ');
    const list=document.createElement('div'); list.className='list';

    cart.forEach((i,idx)=>{
      const row=document.createElement('div'); row.className='item';
      row.innerHTML = `
        <div class="thumb"><img src="${i.img}" alt="" onerror="this.onerror=null;this.src='assets/placeholder.jpg'"></div>
        <div><div class="title">${i.title}</div><div class="muted">${i.price}</div></div>
        <div class="qty">
          <button class="btn" aria-label="minus">−</button>
          <span>${i.qty}</span>
          <button class="btn" aria-label="plus">+</button>
        </div>
        <button class="btn" aria-label="remove">${L.remove}</button>
      `;
      const [minusBtn, qtyEl, plusBtn] = row.querySelectorAll('.qty .btn, .qty span');
      minusBtn.onclick=()=>{ const c=read(); if(c[idx].qty>1)c[idx].qty--; else c.splice(idx,1); write(c); };
      plusBtn.onclick =()=>{ const c=read(); c[idx].qty++; write(c); };
      row.querySelector('[aria-label="remove"]').onclick=()=>{ const c=read(); c.splice(idx,1); write(c); };
      list.appendChild(row);
    });

    const total=document.createElement('div'); total.className='total';
    total.innerHTML = `
      <div><strong>${L.yourOrder}</strong> ${totalText}</div>
      <div class="actions">
        <button class="btn" id="clear">${L.clear}</button>
        <a class="btn btn--primary" id="wa" target="_blank" rel="noopener">${L.checkout}</a>
      </div>
    `;

    root.innerHTML='';
    root.appendChild(list);
    root.appendChild(total);

    document.getElementById('clear').onclick=()=>write([]);

    const text = encodeURIComponent('Здравствуйте! Хочу оформить заказ:\n\n'+
      cart.map(i=>`• ${i.title} — ${i.price} × ${i.qty}`).join('\n'));

    const waLink = 'https://wa.me/77054510584?text='+text;
    const waEl = document.getElementById('wa');
    waEl.href = waLink;
    /* Конверсия WhatsApp отслеживается через GTM (Click URL содержит wa.me) */

    updateBadge();
  }

  /* Badge + язык */
  function updateBadge(){
    const count=read().reduce((s,i)=>s+i.qty,0);
    const b=document.getElementById('cartBadge');
    b.style.display = count>0 ? 'inline-block':'none';
    if(count>0) b.textContent=count;
  }
  window.addEventListener('storage',e=>{ if(e.key===KEY) render(); });
  window.addEventListener('focus', render);

  const ruBtn=document.getElementById('ruBtn'), kkBtn=document.getElementById('kkBtn'), enBtn=document.getElementById('enBtn');
  ruBtn.onclick=()=>{ localStorage.setItem('lang','ru'); setLangButtons(); render(); };
  kkBtn.onclick=()=>{ localStorage.setItem('lang','kk'); setLangButtons(); render(); };
  enBtn.onclick=()=>{ localStorage.setItem('lang','en'); setLangButtons(); render(); };
  setLangButtons();

  render();
</script>
</body>
</html>
